-module(block_tester).
%-behaviour(gen_server).
-export([test/0,absorb/1]).
-record(block, {height = 0, txs = [], hash = "", bond_size = 1000000, pub = ""}).
-record(signed, {data="", sig="", sig2="", revealed=[]}).
absorb_helper(SignedBlock) -> 
%Slasher needs to be general enough to punish validators for signing on anything that could get accepted by this function.
    Block = SignedBlock#signed.data,
    BH = hash:doit(Block),
    false = block_tree:is_key(BH),
    false = block_blacklist:is_key(BH),
    io:fwrite("write 1.5\n"),
    block_blacklist:append(BH, Block#block.height),
    io:fwrite("write 2\n"),
    block_tree:write(SignedBlock),%err
    block_blacklist:remove(BH),
    block_blacklist:remove_old(Block#block.height).
absorb([]) -> [].
absorb([Block|T]) -> [absorb_helper(Block)|absorb(T)].
test() -> 
